<div class="data-management-content">
    <div class="row g-0 justify-content-center h-100 w-100 overflow-auto">
        <div class="col-11 pt-4 pb-4">
            <div class="form-paper">
                <h4>
                    <i class="fa fa-list-check"></i>
                    {{account.name}} To Do List:
                </h4>
                <div class="d-flex justify-content-between mb-3">
                    <div class="d-flex flex-column">
                        <div class="d-flex">
                            <select class="form-select" id="outdatedDays" name="outdatedDays"
                                [(ngModel)]="account.toDoListOutdatedDays" (change)="updateIncludedItems()">
                                <option *ngFor="let days of outdatedDaysOptions" [value]="days">
                                    Data outdated after {{days}} days</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex flex-column" *ngIf="hasTodoItems">
                        <button class="btn btn-outline mb-2" (click)="openWeatherPredictorModal()"
                            *ngIf="showWeatherButton">
                            <span class="fa fa-temperature-half"></span>
                            Update Weather Predictors
                        </button>
                        <button class="btn nav-btn" (click)="goToUpload()">
                            <span class="fa fa-upload"></span>
                            Upload Data
                        </button>
                    </div>
                </div>
                <hr class="my-2">
                <p>
                    The following items have been identified as needing action for this account. Click the item in the
                    list and you will be brought to the location within VERIFI to address it.
                </p>
                <ng-template [ngIf]="hasTodoItems" [ngIfElse]="noToDoItems">
                    <ul class="list-group" [ngClass]="{'list-group-flush': totalTodoItems > 10}">
                        <!--Other Todo Items-->
                        <li class="list-group-item list-group-item-action bold"
                            *ngFor="let item of toDoItems.otherItems; let index = index;" [routerLink]="item.url">
                            {{item.label}}
                            <p class="fw-light mb-0 ms-3" *ngIf="item.description">
                                {{item.description}}</p>
                        </li>
                        <!--Items shown by facility-->
                        <ng-template [ngIf]="totalTodoItems > 10" [ngIfElse]="listItemsBlock">
                            <ng-container
                                *ngFor="let facilityItem of toDoItems.facilityTodoItems; let facilityIndex = index;">
                                <li class="list-group-item bold">
                                    <span class="fa fa-industry"
                                        [ngStyle]="{'color': facilityItem.facility.color}"></span>
                                    {{facilityItem.facility.name}}
                                    <span class="badge bg-secondary float-end">
                                        {{facilityItem.numberOfItems}} items
                                    </span>
                                </li>
                                <li class="list-group-item list-group-item-action sub-item-1"
                                    (click)="toggleShowMeterItem(facilityIndex)">
                                    <span class="fa"
                                        [ngClass]="{'fa-chevron-right': !facilityItem.showMeterItems, 'fa-chevron-down': facilityItem.showMeterItems}"></span>
                                    Meter To Do Items: {{facilityItem.meterTodoItems.length}}
                                </li>
                                <ng-container *ngIf="facilityItem.showMeterItems">
                                    <li class="list-group-item list-group-item-action sub-item-2"
                                        *ngFor="let meterItem of facilityItem.meterTodoItems; let meterIndex = index;"
                                        [routerLink]="meterItem.url">
                                        {{meterItem.label}}
                                        <p class="fw-light mb-0 ms-3" *ngIf="meterItem.description">
                                            {{meterItem.description}}</p>
                                    </li>
                                </ng-container>
                                <li class="list-group-item list-group-item-action sub-item-1"
                                    (click)="toggleShowPredictorItem(facilityIndex)">
                                    <span class="fa"
                                        [ngClass]="{'fa-chevron-right': !facilityItem.showPredictorItems, 'fa-chevron-down': facilityItem.showPredictorItems}"></span>
                                    Predictor To Do Items: {{facilityItem.predictorTodoItems.length}}
                                </li>
                                <ng-container *ngIf="facilityItem.showPredictorItems">
                                    <li class="list-group-item list-group-item-action sub-item-2"
                                        *ngFor="let predictorItem of facilityItem.predictorTodoItems; let predictorIndex = index;"
                                        [routerLink]="predictorItem.url">
                                        <span class="fa fa-temperature-half pe-2"
                                            *ngIf="predictorItem.isWeather"></span>
                                        {{predictorItem.label}}
                                        <p class="fw-light mb-0 ms-3" *ngIf="predictorItem.description">
                                            {{predictorItem.description}}</p>
                                    </li>
                                </ng-container>
                            </ng-container>
                        </ng-template>
                        <!--List of all To Do Items-->
                        <ng-template #listItemsBlock>
                            <li class="list-group-item list-group-item-action"
                                *ngFor="let todoItem of allTodoItems; let meterIndex = index;"
                                [routerLink]="todoItem.url">
                                <div class="d-flex w-100 justify-content-between">
                                    <div class="p-0 bold">
                                        <span class="fa fa-temperature-half pe-2" *ngIf="todoItem.isWeather"></span>
                                        {{todoItem.label}}
                                    </div>
                                    <div>
                                        @let facility = todoItem.facilityId | facilityItem;
                                        <span class="badge"
                                            [ngStyle]="{'background-color': facility.color}">{{facility.name}}</span>
                                    </div>
                                </div>
                                <p class="fw-light mb-0 ms-3" *ngIf="todoItem.description">
                                    {{todoItem.description}} ({{todoItem.facilityId | facilityName}})</p>
                            </li>
                            <p class="mt-2" *ngIf="hasInitialSetupItems">
                                <span class="fa fa-circle-exclamation"></span>
                                A combination of data upload and manual data entry can be done.
                            </p>
                        </ng-template>

                    </ul>
                </ng-template>
                <ng-template #noToDoItems>
                    <div class="alert alert-info" role="alert">
                        <i class="fa fa-check-circle"></i>
                        No items to do at this time. Proceed to data evaluation and analysis!
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>

<app-update-weather-predictors-modal *ngIf="showWeatherPredictorModal"
    (emitClose)="closeWeatherPredictorModal()"></app-update-weather-predictors-modal>