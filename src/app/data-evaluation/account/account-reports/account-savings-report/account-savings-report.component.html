<div>
    <div *ngIf="calculatingAnalysis == false">
        <div
            *ngIf="accountSavingsReportSetup.includeAnnualResultsTable || accountSavingsReportSetup.includeAnnualResultsGraph">
            <div class="report" [ngClass]="{'print': print}">
                <div class="text-center">
                    <h3>
                        {{ selectedReport.name }}
                    </h3>
                    <h6>
                        Generated By VERIFI
                    </h6>
                </div>
                <div class="w-100 x-scroll">
                    <h4>
                        Annual Account Analysis
                    </h4>
                    <app-annual-analysis-summary-table
                        *ngIf="selectedAnnualAnalysisSummary && selectedAnnualAnalysisSummary.length > 0 && accountSavingsReportSetup.includeAnnualResultsTable"
                        [annualAnalysisSummary]="selectedAnnualAnalysisSummary" [analysisItem]="selectedAnalysisItem"
                        [accountOrFacility]="account" [printBlock]="'all'">
                    </app-annual-analysis-summary-table>
                </div>
                <app-annual-analysis-summary-graph
                    *ngIf="selectedAnnualAnalysisSummary && selectedAnnualAnalysisSummary.length > 0 && accountSavingsReportSetup.includeAnnualResultsGraph"
                    [annualAnalysisSummary]="selectedAnnualAnalysisSummary"
                    [annualAnalysisSummary]="selectedAnnualAnalysisSummary" [analysisItem]="selectedAnalysisItem">
                </app-annual-analysis-summary-graph>
            </div>
        </div>

        <div
            *ngIf="accountSavingsReportSetup.includeFacilityResultsTable || accountSavingsReportSetup.includeFacilityResultsGraph">
            <div class="report" [ngClass]="{'print': print}">
                <div class="text-center"
                    *ngIf="!accountSavingsReportSetup.includeAnnualResultsTable && !accountSavingsReportSetup.includeAnnualResultsGraph">
                    <h3>
                        {{ selectedReport.name }}
                    </h3>
                    <h6>
                        Generated By VERIFI
                    </h6>
                </div>
                <ng-container>
                    <div *ngFor="let summary of selectedFacilitySummaries">
                        <h4>
                            Annual {{ summary.facilitySummary.facility.name }} Analysis
                        </h4>
                        <div class="w-100 scroll-x">
                            <app-annual-analysis-summary-table
                                *ngIf="summary.annualFacilityAnalysisSummaries && summary.annualFacilityAnalysisSummaries.length > 0 && accountSavingsReportSetup.includeFacilityResultsTable"
                                [annualAnalysisSummary]="summary.annualFacilityAnalysisSummaries"
                                [analysisItem]="summary.facilitySummary.analysisItem"
                                [accountOrFacility]="summary.facilitySummary.facility" [printBlock]="'all'">
                            </app-annual-analysis-summary-table>
                        </div>

                        <app-annual-analysis-summary-graph
                            *ngIf="summary.annualFacilityAnalysisSummaries && summary.annualFacilityAnalysisSummaries.length > 0 && accountSavingsReportSetup.includeFacilityResultsGraph"
                            [annualAnalysisSummary]="summary.annualFacilityAnalysisSummaries"
                            [analysisItem]="summary.facilitySummary.analysisItem">
                        </app-annual-analysis-summary-graph>
                        <hr>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

    <div
        *ngIf="calculatingPerformance == false && selectedPerformanceReport.annualFacilityData.length > 0 && selectedPerformanceReport.facilityTotals.length > 0 && (accountSavingsReportSetup.includePerformanceResultsTable || accountSavingsReportSetup.includePerformanceResultsGraph)">
        <div class="report" [ngClass]="{'print': print}">
            <div class="text-center"
                *ngIf="!accountSavingsReportSetup.includeAnnualResultsTable && !accountSavingsReportSetup.includeAnnualResultsGraph && !accountSavingsReportSetup.includeFacilityResultsTable && !accountSavingsReportSetup.includeFacilityResultsGraph">
                <h3>
                    {{ selectedReport.name }}
                </h3>
                <h6>
                    Generated By VERIFI
                </h6>
            </div>
            <ng-container>
                <h4>
                    Facility Performance Analysis
                </h4>
                <div class="w-100 scroll-x">
                    <app-performance-report-facility-table
                        *ngIf="performanceReport && accountSavingsReportSetup.includePerformanceResultsTable"
                        [account]="account" [performanceReport]="selectedPerformanceReport"
                        [selectedAnalysisItem]="selectedAnalysisItem"
                        [performanceReportSetup]="selectedReport.performanceReportSetup"></app-performance-report-facility-table>
                </div>
                <app-performance-chart
                    *ngIf="performanceReport && accountSavingsReportSetup.includePerformanceResultsGraph"
                    [performanceReport]="selectedPerformanceReport" [chartDataOption]="'savings'"
                    [chartDataType]="'facility'"
                    [performanceReportSetup]="selectedReport.performanceReportSetup"></app-performance-chart>
            </ng-container>
        </div>
    </div>
</div>

<div class="w-100 justify-content-center">
    <div class="pt-5">
        <app-calculating-spinner *ngIf="calculatingPerformance != false && calculatingAnalysis != false"
            [message]="'Generating Savings Report...'"
            [error]="calculatingPerformance == 'error' || calculatingAnalysis == 'error'"></app-calculating-spinner>
    </div>
</div>

<app-print-report-button *ngIf="selectedReport"></app-print-report-button>