<div class="wrapper main-content">
    <h4>Meter Grouping</h4>
    <p>Your meters have been grouped by type. You are free to edit or add groups based on your preferences. These groups will represent your data visualization.</p>
    <!--<button class="btn btn-primary item-right">Add New Group</button>-->
    <br>

    <div class="group-section">
        <h5>Energy</h5> 
        <span class="item-right">Placeholder</span>
        <span class="item-right spacer"> | </span>
        <label class="item-right">Final Unit:
            <select type="text">
                <option value="MMBtu" selected>MMBtu</option>
                <option value="Kwh">kWh</option>
            </select>
        </label>
    </div>
    <div class="group-section-folders">
        <div class="grouped-list" *ngFor="let meterGroup of meterGroups">
            <div class="row group-title">
                <h6 class="bold col"><i class="fa fa-caret-right"></i>#{{meterGroup.id}} {{meterGroup.name}}</h6>

                <div class="col-3"> 
                    <div class="progress">
                        <div class="progress-bar" [ngClass]="meterGroup.name" role="progressbar" [style.width.%]="meterGroup.fracTotEnergy" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        <span class="tooltip up">(total energy in this group / total energy in all groups)*100<span class="arrow arrow-up"></span></span>
                    </div>
                    <span class="progress-bar-data">{{meterGroup.fracTotEnergy}}%</span>
                    
                </div>
                
                <div class="col-1">
                    <i class="fa fa-ellipsis-v item-right" (click)="groupToggleMenu(meterGroup.id)"></i>
                    <div class="groupMenu" [class.open]="groupMenuOpen === meterGroup.id">
                        <!--<p>View</p>-->
                        <p (click)="groupEdit(meterGroup.id)">Edit</p>
                        <hr>
                        <p (click)="groupDelete(meterGroup.id)">Delete</p>
                    </div>
                </div>
            </div>
            <div class="row" [hidden]="">
                <div class="col">
                    <p class="group-desc">{{meterGroup.desc}}</p>
                </div>
            </div>
            

            <div cdkDropList id=energy{{meterGroup.id}} [cdkDropListData]="meterGroup.data" (cdkDropListDropped)="drop($event)" [cdkDropListConnectedTo]="connectedTo">
                <div [class.show]="meterGroup.data == ''" class="group-meters-placeholder"></div>
                <div class="group-meters" *ngFor="let meter of meterGroup.data" cdkDrag>
                    <i class="fa fa-th"></i> 
                    <span> {{meter.name}}</span> 
                    <span class="item-right">{{meter.type}}</span>
                </div>
            </div>
        </div>
        <button class="btn btn-link" (click)="groupAdd('Energy', 'New Group '  + (+meterGroups.length + +1))"><i class="fa fa-plus"></i> Add New Group</button> 
    </div>

    <br>

    <div class="group-section">
        <h5>Water:</h5> 
        <span class="item-right">Placeholder</span>
        <span class="item-right spacer"> | </span>
        <label class="item-right">Final Unit:
            <select type="text">
                <option value="MMBtu" selected>MMBtu</option>
                <option value="Kwh">kWh</option>
            </select>
        </label>
    </div>
    <!--<div class="row">
        <div class="col-4" *ngFor="let meterGroup of meterGroups">
            <div class="meter-group">

                <div class="meter-group-header">
                    <i class="fa fa-ellipsis-v item-right" (click)="groupToggleMenu(meterGroup.id)"></i>
                    <div class="groupMenu" [class.open]="groupMenuOpen === meterGroup.id">
                        <p>View</p>
                        <p (click)="groupEdit(meterGroup.id)">Edit</p>
                        <hr>
                        <p (click)="groupDelete(meterGroup.id)">Delete</p>
                    </div>

                    <h6 class="bold"><i class="fa fa-folder-open-o"></i> {{meterGroup.name}}</h6>
                    <hr>
                    <p>{{meterGroup.desc}}</p>
                </div>

                <div class="meter-group-stats">
                    <plotly-plot [data]="chart.data" [layout]="chartLayout.layout" [config]="chartLayout.config"></plotly-plot>
                    <p>Fraction of total energy</p>
                </div>

                <div class="meter-group-footer">
                    <p class="item-left">Final Unit: {{meterGroup.unit}}</p>
                    <p class="item-right meterCount">Meters: <span class="group">{{meterGroup.data.length}}</span>
                        <span class="tooltip up">{{meterGroup.types}}<span class="arrow arrow-up"></span></span>
                    </p>
                </div>
                <div class="meter-group-updated">
                    <p class="item-right">Last Updated: {{meterGroup.dateModified}}</p>
                </div>
            </div>
        </div>
    </div>-->
    <br>
    
    <div class="group-section">
        <h5>Waste Water:</h5> 
        <span class="item-right">Placeholder</span>
        <span class="item-right spacer"> | </span>
        <label class="item-right">Final Unit:
            <select type="text">
                <option value="MMBtu" selected>MMBtu</option>
                <option value="Kwh">kWh</option>
            </select>
        </label>
    </div>

    <!--
    <hr>
    <h5>Waste</h5>
    <h5>Other</h5>
    -->

    <div class="window" [class.open]="popup == true">
        <div class="windowOverlay"></div>
        <div class="windowContent">
            <h4>Edit Group</h4>
            <br>
            <p class="bold">Group Information</p>
            <form [formGroup]="groupForm">
                <label hidden>ID
                    <input type="text" formControlName="id" minlength="1" maxlength="10">
                </label>
                <label hidden>Date Modified
                    <input type="text" formControlName="dateModified" minlength="1" maxlength="40">
                </label>
                <label hidden>Group Type
                    <input type="text" formControlName="groupType" minlength="1" maxlength="11">
                </label>
                
                <label>Name
                    <input type="text" formControlName="name" minlength="1" maxlength="50">
                </label>
                <br>
                <label>Description
                    <textarea formControlName="desc" minlength="1" maxlength="65"></textarea>
                </label>
                <br>
                <label hidden>Final Unit
                    <select type="text" formControlName="unit">
                        <option value="MMBtu">MMBtu</option>
                        <option value="Kwh">kWh</option>
                    </select>
                </label>
                <br>
                <label hidden>Data
                    <input type="text" formControlName="data">
                </label>
                <br>
                <label hidden>fracTotEnergy
                    <input type="text" formControlName="fracTotEnergy">
                </label>
            </form>
            <div class="saveCancel item-right">
                <button class="btn btn-primary" (click)="popup = !popup">Cancel</button>
                <button class="btn btn-primary" (click)="groupSave()">Save</button>
            </div>
        </div>
    </div>
</div>

<div class="wizard">
    <button class="btn btn-secondary item-left" routerLink="/utility/mo-meter-data">Prev</button>
    <button class="btn btn-primary item-right" routerLink="/utility/predictors">Next</button>
</div>