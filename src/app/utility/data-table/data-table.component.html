<div class="wrapper main-content">
    <h4>Data Table</h4>
    <p>Meter data has been calendarized.</p>
    <br>

    <div class="filter item-right">
        <!--Column Filters-->
        <button class="btn" [ngClass]="{'btn-secondary': !filterColMenu,'btn-blue' : filterColMenu}" (click)="filterColMenu = !filterColMenu; filterInpMenu = false">Filter</button>
        <div class="filter-dropdown" [hidden]="!filterColMenu">
            <label *ngFor="let filterCols of filterCol">
                <input type="checkbox" name="filterCols.name" [checked]="filterCols.filter" (change)="filterCols.filter = !filterCols.filter">{{filterCols.display}}
            </label>
            <br><br>
            <a (click)="showAllColumns();">Show All</a>
        </div>
    </div>

    <div class="meter" *ngFor="let meterLists of meterList">
        <div class="meterData">
            <p><span class="bold">Meter #</span>{{meterLists.meterNumber}}</p>
            <p><span class="bold">Account #</span> {{meterLists.accountNumber}}</p>
            <p><span class="bold">Building / Area</span> {{meterLists.name}}</p>
            <p><span class="bold">Utility Supplier</span> {{meterLists.supplier}}</p>
            <p><span class="bold">Notes</span> {{meterLists.notes}}</p>
        </div>

        <div class="row">
            <div class="col tableData">
            <table>
                <tr>
                    <th class="row-year">Month</th>
                    <th>Total kWh</th>
                    <th>Total Demand</th>
                    <th>Total Cost</th>
                </tr>
                <tr *ngFor="let meterData of meterLists.data">
                    <td>{{meterData.readDate}}</td>
                    <td>{{meterData.totalKwh}}</td>
                    <td>{{meterData.totalDemand}}</td>
                    <td>${{meterData.totalCost}}</td>
                </tr>
            </table>
        </div>
            <div class="col tableMenu">
                <table>
                    <tr>
                        <th></th>
                    </tr>
                    <tr *ngFor="let meterData of meterLists.data">
                        <td (click)="$event.stopPropagation();"> <!-- Prevents closure of menu on document click-->
                            <i class="fa fa-ellipsis-v" (click)="meterDataToggleMenu(meterData.id)" ></i>
                            <div class="meterMenu" [class.open]="meterDataMenuOpen === meterData.id">
                                <p (click)="meterDataEdit(meterLists.id,meterData.id)">Edit</p>
                                <p (click)="meterDataDelete(meterData.id)">Delete</p>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <button class="btn btn-link" (click)="meterDataAdd(meterLists.id)"><i class="fa fa-plus"></i> Add New Bill</button>
    </div>

    <div class="popup" [class.open]="popup == true">
        <div class="popupOverlay"></div>
        <div class="popupContent popupContentLg">
            <!--Input Filters-->
            <div class="filter item-right">
                <button class="btn" [ngClass]="{'btn-secondary': !filterInpMenu,'btn-blue' : filterInpMenu}" (click)="filterInpMenu = !filterInpMenu; filterColMenu = false">Filter</button>
            </div>
            <div class="filter-dropdown" [hidden]="!filterInpMenu">
                <label *ngFor="let filterInps of filterInp">
                    <input type="checkbox" name="filterInps.name" [checked]="filterInps.filter" (change)="filterInps.filter = !filterInps.filter">{{filterInps.display}}
                </label>
                <br><br>
                <a (click)="showAllFields();">Show All</a>
            </div>

            <h4>Edit Electric Bill</h4>
            <p class="bold">General Information</p>
            <form class="meterForm" [formGroup]="meterDataForm">
                <label hidden>ID
                    <input type="text" formControlName="id" hidden>
                </label>
                <br hidden>
                <label hidden>Meter id
                    <input type="text" formControlName="meterid" hidden>
                </label>
                <br hidden>
                <label>Meter Read Date
                    <input type="date" formControlName="readDate">
                </label>
                <br>
                <label [hidden]="!filterInp[0]['filter']">Basic Charge/fixed fee
                    <span class="unit">$</span>
                    <input type="text" formControlName="basicCharge">
                </label>
                <br>
                <label [hidden]="!filterInp[1]['filter'] && !filterInp[2]['filter'] && !filterInp[3]['filter'] && !filterInp[4]['filter']">
                    <p class="bold subheader">Supply Charges</p>
                    <label [hidden]="!filterInp[1]['filter'] && !filterInp[2]['filter']">Block Rates
                        <div class="row no-margin">
                            <div [hidden]="!filterInp[1]['filter']" class="col no-margin">
                                <input type="number" formControlName="supplyBlockAmt">
                            </div>
                            <div [hidden]="!filterInp[1]['filter']" class="col unitKwh">
                                <span class="unit">kWh</span>
                            </div>
                            <div [hidden]="!filterInp[2]['filter']" class="col no-margin">
                                <input type="number" formControlName="supplyBlockCharge">
                            </div>
                            <div [hidden]="!filterInp[2]['filter']" class="col unitCurrency">
                                <span class="unit">$</span>
                            </div>
                        </div>
                    </label>
                    <label [hidden]="!filterInp[3]['filter'] && !filterInp[4]['filter']">Flat Rates
                        <div class="row no-margin">
                            <div [hidden]="!filterInp[3]['filter']" class="col no-margin">
                                <input type="number" formControlName="flatRateAmt">
                            </div>
                            <div [hidden]="!filterInp[3]['filter']"  class="col unitKwh">
                                <span class="unit">kWh</span>
                            </div>
                            <div [hidden]="!filterInp[4]['filter']" class="col no-margin">
                                <input type="number" formControlName="flatRateCharge">
                            </div>
                            <div [hidden]="!filterInp[4]['filter']" class="col unitCurrency">
                                <span class="unit">$</span>
                            </div>
                        </div>
                    </label>
                </label>

                <label [hidden]="!filterInp[5]['filter'] && !filterInp[6]['filter'] && !filterInp[7]['filter'] && !filterInp[8]['filter'] && !filterInp[9]['filter'] && !filterInp[10]['filter']">
                    <p class="bold subheader">Demand Charge</p>
                    <label [hidden]="!filterInp[5]['filter'] && !filterInp[6]['filter']">On-Peak Demand
                        <div class="row no-margin">
                            <div [hidden]="!filterInp[5]['filter']" class="col no-margin">
                                <input type="number" formControlName="peakAmt">
                            </div>
                            <div [hidden]="!filterInp[5]['filter']" class="col unitKwh">
                                <span class="unit">kWh</span>
                            </div>
                            <div [hidden]="!filterInp[6]['filter']" class="col no-margin">
                                <input type="number" formControlName="peakCharge">
                            </div>
                            <div [hidden]="!filterInp[6]['filter']" class="col unitCurrency">
                                <span class="unit">$</span>
                            </div>
                        </div>
                    </label>
                    <label [hidden]="!filterInp[7]['filter'] && !filterInp[8]['filter']">Off-Peak Demand
                        <div class="row no-margin">
                            <div [hidden]="!filterInp[7]['filter']" class="col no-margin">
                                <input type="number" formControlName="offpeakAmt">
                            </div>
                            <div [hidden]="!filterInp[7]['filter']" class="col unitKwh">
                                <span class="unit">kWh</span>
                            </div>
                            <div [hidden]="!filterInp[8]['filter']" class="col no-margin">
                                <input type="number" formControlName="offpeakCharge">
                            </div>
                            <div [hidden]="!filterInp[8]['filter']" class="col unitCurrency">
                                <span class="unit">$</span>
                            </div>
                        </div>
                    </label>
                    <label [hidden]="!filterInp[9]['filter'] && !filterInp[10]['filter']">Block Rates
                        <div class="row no-margin">
                            <div [hidden]="!filterInp[9]['filter']" class="col no-margin">
                                <input type="number" formControlName="demandBlockAmt">
                            </div>
                            <div [hidden]="!filterInp[9]['filter']" class="col unitKwh">
                                <span class="unit">kWh</span>
                            </div>
                            <div [hidden]="!filterInp[10]['filter']" class="col no-margin">
                                <input type="number" formControlName="demandBlockCharge">
                            </div>
                            <div [hidden]="!filterInp[10]['filter']" class="col unitCurrency">
                                <span class="unit">$</span>
                            </div>
                        </div> 
                    </label>
                </label>
                <label [hidden]="!filterInp[11]['filter']">Generation and Transmission charges
                    <span class="unit">$</span>
                    <input type="number" formControlName="genTransCharge">
                </label>
                <label [hidden]="!filterInp[12]['filter']">Delivery Charges
                    <span class="unit">$</span>
                    <input type="number" formControlName="deliveryCharge">
                </label>
                <label [hidden]="!filterInp[13]['filter']">Transmission Charges
                    <span class="unit">$</span>
                    <input type="number" formControlName="transCharge">
                </label>
                <label [hidden]="!filterInp[14]['filter']">Power factor Charges
                    <span class="unit">$</span>
                    <input type="number" formControlName="powerFactorCharge">
                </label>
                
                <br><br>

                <p class="bold" [hidden]="!filterInp[15]['filter'] && !filterInp[16]['filter'] && !filterInp[17]['filter'] && !filterInp[18]['filter']">Tax and other</p>
                <label [hidden]="!filterInp[15]['filter']">Local Business and Occupation Charge
                    <span class="unit">$</span>
                    <input type="text" formControlName="businessCharge">
                </label>
                <label [hidden]="!filterInp[16]['filter']">Local Utility Tax
                    <span class="unit">$</span>
                    <input type="text" formControlName="utilityTax">
                </label>
                <label [hidden]="!filterInp[17]['filter']">Late Payment Charge
                    <span class="unit">$</span>
                    <input type="text" formControlName="latePayment">
                </label>
                <label [hidden]="!filterInp[18]['filter']">Other Charges
                    <span class="unit">$</span>
                    <input type="text" formControlName="otherCharge">
                </label>
                <hr>
                <p class="bold">Totals</p>
                <label>Total kWh
                    <span class="unit">$</span>
                    <input type="text" formControlName="totalKwh">
                </label>
                <label>Total Demand
                    <span class="unit">$</span>
                    <input type="text" formControlName="totalDemand">
                </label>
                <label>Total Cost
                    <span class="unit">$</span>
                    <input type="text" formControlName="totalCost">
                </label>
            </form>

            <hr>
            <a (click)="showAllFields();">Show All Fields</a><br>

            <div class="saveCancel item-right">
                <button class="btn btn-primary" (click)="popup = !popup">Cancel</button>
                <button class="btn btn-primary" (click)="meterDataSave()">Save</button>
            </div>
        </div>
    </div>
</div>