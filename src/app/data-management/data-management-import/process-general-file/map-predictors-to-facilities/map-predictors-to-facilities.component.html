<div class="data-management-content with-footer">
    <div class="row g-0 justify-content-center h-100 w-100 overflow-container">
        <div class="col-11 pt-4 pb-4 h-100">
            <div class="form-paper d-flex flex-column h-100">
                <h4>
                    <div class="d-flex w-100 justify-content-between">
                        <div class="h4 mb-0">
                            Map Predictors to Facilities
                        </div>
                        <div>
                            <span class="badge bg-primary">
                                <span class="fa fa-file"></span>
                                {{fileReference.name}}
                            </span>
                        </div>
                    </div>
                </h4>
                <ng-template [ngIf]="predictorsIncluded" [ngIfElse]="noPredictorsBlock">
                    <div class="d-flex justify-content-end mb-2">
                        <div>
                            <button class="btn btn-outline-success" (click)="openAddFacilityModal()">
                                <span class="fa fa-plus"></span>
                                Add Facility
                            </button>
                        </div>
                    </div>
                    <div class="d-flex h-100 overflow-container">
                        <div class="w-50 me-2 overflow-container">
                            <!--unused-->
                            @let unmappedPredictorsGroup = fileReference.predictorFacilityGroups[0];
                            <div class="card" (cdkDropListDropped)="dropColumn($event)"
                                id={{unmappedPredictorsGroup.facilityId}} cdkDropList
                                [cdkDropListData]="fileReference.predictorFacilityGroups"
                                [cdkDropListConnectedTo]="facilityGroupIds">
                                <div class="card-header">
                                    {{unmappedPredictorsGroup.facilityName}}
                                </div>
                                <div class="card-body">
                                    <div class="list-item mt-2 mb-2 p-2" [cdkDragData]="groupItem"
                                        *ngFor="let groupItem of unmappedPredictorsGroup.groupItems" cdkDrag>
                                        <span class="fa fa-arrows-alt"></span>{{groupItem.value}} <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="w-50 ms-2 d-flex flex-column h-100 overflow-container">
                            <ng-container
                                *ngFor="let facilityGroup of fileReference.predictorFacilityGroups; let first = first;">
                                <ng-container *ngIf="!first">
                                    <div class="card" cdkDropList (cdkDropListDropped)="dropColumn($event)"
                                        id={{facilityGroup.facilityId}} [cdkDropListConnectedTo]="facilityGroupIds">
                                        <div class="card-header">
                                            <i class="fa fa-industry" [ngStyle]="{color: facilityGroup.color}"></i>
                                            {{facilityGroup.facilityName}}
                                            <a class="click-link float-end"
                                                (click)="setFacility(facilityGroup.facilityId)">+Add
                                                All</a>
                                        </div>
                                        <div class="card-body">
                                            <div class="list-item mt-2 mb-2 p-2" [cdkDragData]="groupItem"
                                                *ngFor="let groupItem of facilityGroup.groupItems" cdkDrag>
                                                <span class="fa fa-arrows-alt"></span>{{groupItem.value}} <br>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>
                    </div>
                </ng-template>
                <ng-template #noPredictorsBlock>
                    <div class="alert alert-warning p-2">
                        No predictors found. Go back to column selection and include predictors or click continue to
                        upload included meter
                        data.
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>
<!--TODO: disable next-->
<app-data-management-import-footer [fileReference]="fileReference"
    [navOption]="'map-predictors-to-facilities'"></app-data-management-import-footer>


<div [ngClass]="{'windowOverlay': displayAddFacilityModal}"></div>
<div class="popup" [class.open]="displayAddFacilityModal" *ngIf="displayAddFacilityModal">
    <div class="popup-header">Add Facility
        <button class="item-right" (click)="cancelAddFacility()">x</button>
    </div>
    <div class="popup-body">
        <form>
            <label for="addFacilityName">
                Facility Name
            </label>
            <input class="form-control" type="text" [(ngModel)]="addFacilityName" name="addFacilityName"
                id="addFacilityName">
        </form>
    </div>
    <div class="popup-footer text-end">
        <button class="btn btn-secondary" (click)="cancelAddFacility()">Cancel</button>
        <button class="btn btn-outline-success" (click)="addFacility()">
            <span class="fa fa-plus"></span>
            Add Facility
        </button>
    </div>
</div>