<h4>Electricity Bills</h4>

<div class="controls">
    <!--Import/Export-->
    <div class="importExport item-right">
        <button class="btn btn-outline" (click)="openImportModal()">Import</button>
        <button class="btn btn-outline" (click)="meterExport('Electricity')">Export</button>
    </div>
    <!--Bulk Delete-->
    <div class="bulk-delete item-right" [class.show]="is_checked">
        <button class="btn btn-danger" (click)='bulkDelete()'>Bulk Delete</button>
    </div>
    <!--Column Filters-->
    <div class="filter item-right">
        <button class="btn" [ngClass]="{'btn-solid' : !filterColMenu, 'btn-outline' : filterColMenu}"
            (click)="filterColMenu = !filterColMenu; filterInpMenu = false">Filter</button>
        <div class="filter-dropdown" [hidden]="!filterColMenu">
            <label *ngFor="let filterCols of filterCol">
                <input type="checkbox" name="filterCols.name" [checked]="filterCols.filter"
                    (change)="filterCols.filter = !filterCols.filter">{{filterCols.display}}
            </label>
            <br><br>
            <a (click)="showAllColumns();">Show All</a>
        </div>
    </div>
    <!--Items Per Page-->
    <div class="items-per-page item-right">
        <span>Show </span>
        <select (change)="changePagesize($event.target.value)">
            <option value="6">6</option>
            <option value="12">12</option>
            <option value="24">24</option>
            <option value="36">36</option>
            <option value="48">48</option>
            <option value="60">60</option>
        </select>
    </div>
</div>

<div class="meter" *ngFor="let meterListItem of meterList; let i=index;">
    <div class="meterData">
        <h6><i class="fa fa-caret-right"></i> #{{meterListItem.idbMeter.id}} {{meterListItem.idbMeter.name}}</h6>
        <p>{{meterListItem.idbMeter.notes}}</p>

        <button class="btn btn-link item-right" (click)="meterDataAdd(meterListItem.idbMeter)"><i
                class="fa fa-plus"></i> Add New Bill</button>
        <div class="tableControls overflow-hidden item-right">
            <div class="item-right">
                <ngb-pagination [collectionSize]="meterListItem.meterDataItems.length" [(page)]="page[i]"
                    [pageSize]="itemsPerPage" [maxSize]="5" [rotate]="true" aria-label="Default pagination"
                    (pageChange)="onPageChange(i, page[i])"></ngb-pagination>
            </div>
            <p class="item-right">{{meterListItem.meterDataItems.length}} entries</p>
        </div>
    </div>


    <div class="row no-margin">
        <div class="col no-margin tableData">
            <table>
                <tr>
                    <th><input #masterCheckbox type="checkbox" (change)="checkAll(meterListItem.idbMeter.id, $event)">
                    </th>
                    <th class="row-year">Meter Read Date</th>
                    <th>Total kWh</th>
                    <th>Total Demand</th>
                    <th>Total Cost</th>
                    <th [hidden]="!filterCol[0]['filter']">Basic Charge</th>
                    <th [hidden]="!filterCol[1]['filter']">Supply Block Amt</th>
                    <th [hidden]="!filterCol[2]['filter']">Supply Block Charge</th>
                    <th [hidden]="!filterCol[3]['filter']">Flat Rate Amount</th>
                    <th [hidden]="!filterCol[4]['filter']">Flat Rate Charge</th>
                    <th [hidden]="!filterCol[5]['filter']">Peak Amount</th>
                    <th [hidden]="!filterCol[6]['filter']">Peak Charge</th>
                    <th [hidden]="!filterCol[7]['filter']">Off-Peak Amount</th>
                    <th [hidden]="!filterCol[8]['filter']">Off-Peak Charge</th>
                    <th [hidden]="!filterCol[9]['filter']">Demand Block Amt</th>
                    <th [hidden]="!filterCol[10]['filter']">Demand Block Charge</th>
                    <th [hidden]="!filterCol[11]['filter']">Gen Trans Charge</th>
                    <th [hidden]="!filterCol[12]['filter']">Delivery Charge</th>
                    <th [hidden]="!filterCol[13]['filter']">Trans Charge</th>
                    <th [hidden]="!filterCol[14]['filter']">Power Factor Charge</th>
                    <th [hidden]="!filterCol[15]['filter']">Business Charge</th>
                    <th [hidden]="!filterCol[16]['filter']">Utility Tax</th>
                    <th [hidden]="!filterCol[17]['filter']">Late Payment</th>
                    <th [hidden]="!filterCol[18]['filter']">Other Charge</th>
                </tr>
                <tr *ngFor="let meterData of meterListItem.meterDataItems | slice: pageSize[i] | slice: 0:itemsPerPage">
                    <td><input [value]="meterData.id" type="checkbox" name="metersSelected"
                            (change)="checkCheckboxes($event)" [(ngModel)]="meterData.checked"></td>
                    <td>{{meterData.readDate}}</td>
                    <td>{{meterData.totalEnergyUse}}</td>
                    <td>{{meterData.totalDemand}}</td>
                    <td>${{meterData.totalCost}}</td>
                    <td [hidden]="!filterCol[0]['filter']">${{meterData.basicCharge}}</td>
                    <td [hidden]="!filterCol[1]['filter']">{{meterData.supplyBlockAmt}}</td>
                    <td [hidden]="!filterCol[2]['filter']">${{meterData.supplyBlockCharge}}</td>
                    <td [hidden]="!filterCol[3]['filter']">{{meterData.flatRateAmt}}</td>
                    <td [hidden]="!filterCol[4]['filter']">${{meterData.flatRateCharge}}</td>
                    <td [hidden]="!filterCol[5]['filter']">{{meterData.peakAmt}}</td>
                    <td [hidden]="!filterCol[6]['filter']">${{meterData.peakCharge}}</td>
                    <td [hidden]="!filterCol[7]['filter']">{{meterData.offpeakAmt}}</td>
                    <td [hidden]="!filterCol[8]['filter']">${{meterData.offpeakCharge}}</td>
                    <td [hidden]="!filterCol[9]['filter']">{{meterData.demandBlockAmt}}</td>
                    <td [hidden]="!filterCol[10]['filter']">${{meterData.demandBlockCharge}}</td>
                    <td [hidden]="!filterCol[11]['filter']">${{meterData.genTransCharge}}</td>
                    <td [hidden]="!filterCol[12]['filter']">${{meterData.deliveryCharge}}</td>
                    <td [hidden]="!filterCol[13]['filter']">${{meterData.transCharge}}</td>
                    <td [hidden]="!filterCol[14]['filter']">${{meterData.powerFactorCharge}}</td>
                    <td [hidden]="!filterCol[15]['filter']">${{meterData.businessCharge}}</td>
                    <td [hidden]="!filterCol[16]['filter']">${{meterData.utilityTax}}</td>
                    <td [hidden]="!filterCol[17]['filter']">${{meterData.latePayment}}</td>
                    <td [hidden]="!filterCol[18]['filter']">${{meterData.otherCharge}}</td>
                </tr>
            </table>
        </div>
        <div class="col tableMenu">
            <table>
                <tr>
                    <th></th>
                </tr>
                <tr *ngFor="let meterData of meterListItem.meterDataItems | slice: pageSize[i] | slice: 0:itemsPerPage">
                    <td (click)="$event.stopPropagation();">
                        <!-- Prevents closure of menu on document click-->
                        <i class="fa fa-ellipsis-v" (click)="meterDataToggleMenu(meterData.id)"></i>
                        <div class="meterMenu" [class.open]="meterDataMenuOpen === meterData.id">
                            <p (click)="setEditMeterData(meterData)">Edit</p>
                            <p (click)="setDeleteMeterData(meterData)">Delete</p>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="window" [class.open]="editMeterData">
    <div class="windowOverlay"></div>
    <div class="windowContent windowContentLg">
        <app-edit-electric-bill *ngIf="editMeterData" [editMeterData]="editMeterData" (emitClose)="cancelEditMeter()"
            [addOrEdit]="addOrEdit">
        </app-edit-electric-bill>
    </div>
</div>


<div class="window" [class.open]="showImport">
    <div class="windowOverlay"></div>
    <div class="windowContent">
        <app-import-meter-data *ngIf="showImport" (emitClose)="closeImportModal()"></app-import-meter-data>
    </div>
</div>