<div class="wrapper" *ngIf="facilityReports.length != 0">
    <div class="row mb-5">
        <label class="form-label fw-bold">Filter by Report Type:</label>
        <div class="col-2">
            <select class="form-select" [(ngModel)]="selectedReportType">
                <option value="">All</option>
                <option *ngFor="let type of reportTypes" [value]="type">{{ type | facilityReportType}}</option>
            </select>
        </div>
        <div class="col">
            <app-table-items-dropdown></app-table-items-dropdown>
        </div>
    </div>

    <div class="table-responsive mt-4">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th class="can-click" (click)="setOrderDataField('name')"
                        [ngClass]="{'active': orderDataField == 'name'}">
                        Report Name
                    </th>
                    <th class="can-click" (click)="setOrderDataField('facilityReportType')"
                        [ngClass]="{'active': orderDataField == 'facilityReportType'}">
                        Report Type
                    </th>
                    <th class="can-click" (click)="setOrderDataField('analysisItemId')"
                        [ngClass]="{'active': orderDataField == 'analysisItemId'}">
                        Analysis Item
                    </th>
                    <th class="can-click" (click)="setOrderDataField(sortYear)"
                        [ngClass]="{'active': orderDataField == sortYear}">
                        Report Year
                    </th>
                    <th class="can-click" (click)="setOrderDataField('modifiedDate')"
                        [ngClass]="{'active': orderDataField == 'modifiedDate'}">
                        Last Modified
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr
                    *ngFor="let data of facilityReports | facilityReportOrderBy: orderDataField: orderByDirection: selectedReportType | slice: ((currentPageNumber-1) * itemsPerPage): currentPageNumber * itemsPerPage;">
                    <td>
                        {{ data.name }}
                    </td>
                    <td>
                        <span class="badge" [ngClass]="data.facilityReportType | facilityReportBadgeClass">{{ data.facilityReportType |
                            facilityReportType }}</span>
                    </td>
                    <td *ngIf="data.analysisItemId">{{ data.analysisItemId | facilityAnalysisName}}</td>
                    <td *ngIf="!data.analysisItemId"> &mdash; </td>
                    <td [ngSwitch]="data.facilityReportType">
                        <ng-container *ngSwitchCase="'emissionFactors'">
                            <ng-container *ngIf="data.emissionFactorsReportSettings.startYear != undefined">
                                {{ data.emissionFactorsReportSettings.startYear }} -
                            </ng-container>
                            <ng-container *ngIf="data.emissionFactorsReportSettings.endYear != undefined">
                                {{ data.emissionFactorsReportSettings.endYear }}
                            </ng-container>
                            <ng-container
                                *ngIf="data.emissionFactorsReportSettings.startYear === undefined && data.emissionFactorsReportSettings.endYear === undefined">
                                &mdash;
                            </ng-container>
                        </ng-container>

                        <ng-container *ngSwitchCase="'overview'">
                            <ng-container
                                *ngIf="data.dataOverviewReportSettings.startMonth != undefined && data.dataOverviewReportSettings.startYear != undefined">
                                {{ data.dataOverviewReportSettings.startMonth | reportDate: data.dataOverviewReportSettings.startYear | date: 'MMM. y' }} -
                            </ng-container>
                            <ng-container
                                *ngIf="data.dataOverviewReportSettings.endMonth != undefined && data.dataOverviewReportSettings.endYear != undefined">
                                {{ data.dataOverviewReportSettings.endMonth | reportDate: data.dataOverviewReportSettings.endYear | date: 'MMM. y' }}
                            </ng-container>
                            <ng-container
                                *ngIf="data.dataOverviewReportSettings.startMonth === undefined && data.dataOverviewReportSettings.startYear === undefined && data.dataOverviewReportSettings.endMonth === undefined && data.dataOverviewReportSettings.endYear === undefined">
                                &mdash;
                            </ng-container>
                        </ng-container>

                        <ng-container *ngSwitchCase="'savings'">
                            <ng-container *ngIf="data.savingsReportSettings.endYear !== undefined">
                                {{ data.savingsReportSettings.endYear }}
                            </ng-container>
                            <ng-container *ngIf="data.savingsReportSettings.endYear === undefined">
                                &mdash;
                            </ng-container>
                        </ng-container>

                        <ng-container *ngSwitchDefault>
                            &mdash;
                        </ng-container>
                    </td>
                    <td>
                        {{ data.modifiedDate | date:'short' }}
                    </td>
                    <td class="text-center">
                        <button title="View" class="btn action-btn btn-sm me-2" (click)="selectReport(data)">
                            <i class="fa fa-eye"></i>
                        </button>
                        <button title="Copy" class="btn action-btn btn-sm me-2" (click)="createCopy(data)">
                            <i class="fa fa-copy"></i>
                        </button>
                        <button title="Delete" class="btn action-btn btn-sm me-2" (click)="deleteItem(data)">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="d-flex w-100 justify-content-end">
        <ngb-pagination [collectionSize]="(facilityReports | facilityReportOrderBy: orderDataField: orderByDirection: selectedReportType).length" [(page)]="currentPageNumber" [pageSize]="itemsPerPage"
            [maxSize]="5" [rotate]="true" aria-label="Pagination">
        </ngb-pagination>
    </div>
</div>


<div class="card card-body" *ngIf="facilityReports.length == 0">
    <div class="text-center bold">
        No reports found for this facility. Click "+Add New Report" to create your first report!
    </div>
</div>

<div [ngClass]="{'windowOverlay': displayDeleteModal}"></div>
<div class="popup" [class.open]="displayDeleteModal">
    <div class="popup-header" *ngIf="displayDeleteModal">Delete: {{deletedReport.name}}
        <button class="item-right" (click)="cancelDelete()">x</button>
    </div>
    <div class="popup-body">
        <p>WARNING: Deleting this report cannot be undone.</p>
    </div>
    <div class="saveCancel popup-footer text-end">
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Delete</button>
    </div>
</div>