<div *ngIf="facilityReport && calculating != true">
    <div class="report" [ngClass]="{'print': print}"
        *ngIf="facilityReport.savingsReportSettings.facilityAnnualResults && ((facilityReport.savingsReportSettings.facilityAnnualResultsTable) || (facilityReport.savingsReportSettings.facilityMonthlyResults && (facilityReport.savingsReportSettings.facilityMonthlyResultsTable || facilityReport.savingsReportSettings.facilityMonthlyResultsGraphs ||     facilityReport.savingsReportSettings.facilityTrailingTwelveMonthsConsumption || facilityReport.savingsReportSettings.facilityTrailingTwelveMonthsSavings)))">
        <div class="text-center">
            <h3>
                {{ facilityReport.name }}
            </h3>
            <h6>
                Generated By VERIFI
            </h6>
        </div>
        <ng-container *ngIf="facilityReport.savingsReportSettings.facilityAnnualResultsTable">
            <div class="mt-5">
                <h4>
                    Annual Facility Analysis
                </h4>
            </div>
            <ng-template
                [ngIf]="!print || !(facilityReport.savingsReportSettings.analysisTableColumns | breakUpTableForPrint: 'annual')"
                [ngIfElse]="printBlock">
                <div class="scroll-x">
                    <app-annual-analysis-summary-table *ngIf="annualAnalysisSummaries"
                        [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="analysisItem"
                        [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="facility" [printBlock]="'all'">
                    </app-annual-analysis-summary-table>
                </div>
            </ng-template>

            <ng-template #printBlock>
                <app-annual-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'consumption'"
                    [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="analysisItem"
                    [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="facility"
                    [printBlock]="'consumption'">
                </app-annual-analysis-summary-table>
                <app-annual-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'predictors'"
                    [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="analysisItem"
                    [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="facility"
                    [printBlock]="'predictors'">
                </app-annual-analysis-summary-table>
                <app-annual-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'savings'"
                    [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="analysisItem"
                    [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="facility" [printBlock]="'savings'">
                </app-annual-analysis-summary-table>
            </ng-template>

            <div class="print-break-after"></div>
        </ng-container>

        <ng-container
            *ngIf="facilityReport.savingsReportSettings.facilityMonthlyResults && facilityReport.savingsReportSettings.facilityMonthlyResultsTable">
            <div class="mt-5">
                <h4>
                    Monthly Facility Analysis
                </h4>
            </div>
            <div class="d-flex w-100 justify-content-end mb-2">
                <app-table-items-dropdown></app-table-items-dropdown>
            </div>
            <ng-template
                [ngIf]="!print || !(facilityReport.savingsReportSettings.analysisTableColumns| breakUpTableForPrint: 'monthly')"
                [ngIfElse]="reportPrintBlock">
                <div class="scroll-x">
                    <app-monthly-analysis-summary-table [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData"
                        [analysisItem]="analysisItem" [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage"
                        [printBlock]="'all'">
                    </app-monthly-analysis-summary-table>
                </div>
            </ng-template>

            <ng-template #reportPrintBlock>
                <app-monthly-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'consumption'"
                    [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                    [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage" [printBlock]="'consumption'">
                </app-monthly-analysis-summary-table>

                <app-monthly-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'predictors'"
                    [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                    [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage" [printBlock]="'predictors'">
                </app-monthly-analysis-summary-table>

                <app-monthly-analysis-summary-table
                    *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'savings'"
                    [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                    [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage" [printBlock]="'savings'">
                </app-monthly-analysis-summary-table>
            </ng-template>
            <div class="print-break-after"></div>
        </ng-container>

        <ng-container
            *ngIf="facilityReport.savingsReportSettings.facilityMonthlyResults && facilityReport.savingsReportSettings.facilityMonthlyResultsGraphs">
            <div class="mt-5">
                <h4>
                    Monthly Facility Analysis Graphs
                </h4>
            </div>
            <div class="print-break-avoid">
                <app-monthly-analysis-summary-graph *ngIf="monthlyAnalysisSummaryData"
                    [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                    [facilityOrAccount]="facility">
                </app-monthly-analysis-summary-graph>
                <hr>
            </div>
            <div class="print-break-avoid">
                <app-monthly-analysis-summary-savings-graph *ngIf="monthlyAnalysisSummaryData"
                    [analysisItem]="analysisItem" [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData"
                    [facilityOrAccount]="facility">
                </app-monthly-analysis-summary-savings-graph>
            </div>
            <div class="print-break-after"></div>
        </ng-container>

        <div class="print-break-avoid">
            <ng-container
                *ngIf="facilityReport.savingsReportSettings.facilityMonthlyResults && facilityReport.savingsReportSettings.facilityTrailingTwelveMonthsConsumption">
                <div class="mt-5">
                    <app-rolling-energy-consumption-graph *ngIf="monthlyAnalysisSummaryData"
                        [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                        [facilityOrAccount]="facility"></app-rolling-energy-consumption-graph>
                    <hr>
                </div>
                <div class="print-break-after"></div>
            </ng-container>
            <ng-container
                *ngIf="facilityReport.savingsReportSettings.facilityMonthlyResults && facilityReport.savingsReportSettings.facilityTrailingTwelveMonthsSavings">
                <div class="mt-5">
                    <app-rolling-energy-savings-graph *ngIf="monthlyAnalysisSummaryData"
                        [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="analysisItem"
                        [facilityOrAccount]="facility"></app-rolling-energy-savings-graph>
                    <hr>
                </div>
                <div class="print-break-after"></div>
            </ng-container>
        </div>
    </div>

    <div class="report" [ngClass]="{'print': print}"
        *ngIf="facilityReport.savingsReportSettings.groupReports && ((facilityReport.savingsReportSettings.groupAnnualResultsTable) || (facilityReport.savingsReportSettings.groupMonthlyResults && (facilityReport.savingsReportSettings.groupMonthlyResultsTable || facilityReport.savingsReportSettings.groupMonthlyResultsGraphs || facilityReport.savingsReportSettings.groupTrailingTwelveMonthsConsumption || facilityReport.savingsReportSettings.groupTrailingTwelveMonthsSavings)))">
        <div class="text-center"
            *ngIf="!facilityReport.savingsReportSettings.facilityAnnualResults || (!facilityReport.savingsReportSettings.facilityAnnualResultsTable && !facilityReport.savingsReportSettings.facilityMonthlyResults)">
            <h3>
                {{ facilityReport.name }}
            </h3>
            <h6>
                Generated By VERIFI
            </h6>
        </div>
        <ng-container *ngFor="let groupSummary of groupSummaries; let i = index">
            <ng-container *ngIf="facilityReport.savingsReportSettings.groupAnnualResultsTable">
                <div class="mt-5">
                    <h4>
                        {{groupSummary.group.idbGroupId | groupName}} Annual Results
                    </h4>
                </div>
                <ng-template
                    [ngIf]="!print || !(facilityReport.savingsReportSettings.analysisTableColumns | breakUpTableForPrint: 'annual')"
                    [ngIfElse]="printBlock">
                    <div class="scroll-x">
                        <app-annual-analysis-summary-table *ngIf="annualAnalysisSummaries"
                            [annualAnalysisSummary]="groupSummary.annualAnalysisSummaryData"
                            [analysisItem]="analysisItem" [latestMonthSummary]="groupSummary.latestMonthGroupSummary"
                            [accountOrFacility]="facility" [printBlock]="'all'" [group]="groupSummary.group">
                        </app-annual-analysis-summary-table>
                    </div>
                </ng-template>

                <ng-template #printBlock>
                    <app-annual-analysis-summary-table
                        *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'consumption'"
                        [annualAnalysisSummary]="groupSummary.annualAnalysisSummaryData" [analysisItem]="analysisItem"
                        [latestMonthSummary]="groupSummary.latestMonthGroupSummary" [group]="groupSummary.group"
                        [accountOrFacility]="facility" [printBlock]="'consumption'">
                    </app-annual-analysis-summary-table>
                    <app-annual-analysis-summary-table
                        *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'predictors'"
                        [annualAnalysisSummary]="groupSummary.annualAnalysisSummaryData" [analysisItem]="analysisItem"
                        [latestMonthSummary]="groupSummary.latestMonthGroupSummary" [group]="groupSummary.group"
                        [accountOrFacility]="facility" [printBlock]="'predictors'">
                    </app-annual-analysis-summary-table>
                    <app-annual-analysis-summary-table
                        *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'savings'"
                        [annualAnalysisSummary]="groupSummary.annualAnalysisSummaryData" [analysisItem]="analysisItem"
                        [latestMonthSummary]="groupSummary.latestMonthGroupSummary" [group]="groupSummary.group"
                        [accountOrFacility]="facility" [printBlock]="'savings'">
                    </app-annual-analysis-summary-table>
                </ng-template>
                <hr>
                <div class="print-break-after"></div>
            </ng-container>

            <ng-container>
                <ng-container
                    *ngIf="facilityReport.savingsReportSettings.groupMonthlyResults && (facilityReport.savingsReportSettings.groupMonthlyResultsTable || facilityReport.savingsReportSettings.groupMonthlyResultsGraphs || facilityReport.savingsReportSettings.groupTrailingTwelveMonthsConsumption || facilityReport.savingsReportSettings.groupTrailingTwelveMonthsSavings)">
                    <div class="mt-5">
                        <h4>
                            {{groupSummary.group.idbGroupId | groupName}} Monthly Results
                        </h4>
                    </div>
                </ng-container>
                <ng-container
                    *ngIf="facilityReport.savingsReportSettings.groupMonthlyResults && facilityReport.savingsReportSettings.groupMonthlyResultsTable">
                    <div class="d-flex w-100 justify-content-end mb-2">
                        <app-table-items-dropdown></app-table-items-dropdown>
                    </div>
                    <ng-template
                        [ngIf]="!print || !(facilityReport.savingsReportSettings.analysisTableColumns| breakUpTableForPrint: 'monthly')"
                        [ngIfElse]="reportPrintBlock">
                        <div class="scroll-x">
                            <app-monthly-analysis-summary-table
                                [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                                [analysisItem]="analysisItem" [facilityOrAccount]="facility"
                                [itemsPerPage]="itemsPerPage" [printBlock]="'all'">
                            </app-monthly-analysis-summary-table>
                            <hr>
                        </div>
                    </ng-template>
                    <ng-template #reportPrintBlock>
                        <app-monthly-analysis-summary-table
                            *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'consumption'"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem" [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage"
                            [printBlock]="'consumption'">
                        </app-monthly-analysis-summary-table>

                        <app-monthly-analysis-summary-table
                            *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'predictors'"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem" [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage"
                            [printBlock]="'predictors'">
                        </app-monthly-analysis-summary-table>

                        <app-monthly-analysis-summary-table
                            *ngIf="facilityReport.savingsReportSettings.analysisTableColumns | includeTable: 'savings'"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem" [facilityOrAccount]="facility" [itemsPerPage]="itemsPerPage"
                            [printBlock]="'savings'">
                        </app-monthly-analysis-summary-table>
                    </ng-template>
                    <div class="print-break-after"></div>
                </ng-container>

                <ng-container
                    *ngIf="facilityReport.savingsReportSettings.groupMonthlyResults && facilityReport.savingsReportSettings.groupMonthlyResultsGraphs">
                    <div class="print-break-avoid">
                        <app-monthly-analysis-summary-graph *ngIf="monthlyAnalysisSummaryData"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem" [facilityOrAccount]="facility">
                        </app-monthly-analysis-summary-graph>
                    </div>
                    <div class="print-break-avoid">
                        <app-monthly-analysis-summary-savings-graph *ngIf="monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [facilityOrAccount]="facility">
                        </app-monthly-analysis-summary-savings-graph>
                        <hr>
                    </div>
                    <div class="print-break-after"></div>
                </ng-container>

                <div class="print-break-avoid">
                    <ng-container
                        *ngIf="facilityReport.savingsReportSettings.groupMonthlyResults && facilityReport.savingsReportSettings.groupTrailingTwelveMonthsConsumption">
                        <app-rolling-energy-consumption-graph *ngIf="monthlyAnalysisSummaryData"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem"
                            [facilityOrAccount]="facility"></app-rolling-energy-consumption-graph>
                        <hr>
                        <div class="print-break-after"></div>
                    </ng-container>
                    <ng-container
                        *ngIf="facilityReport.savingsReportSettings.groupMonthlyResults && facilityReport.savingsReportSettings.groupTrailingTwelveMonthsSavings">
                        <app-rolling-energy-savings-graph *ngIf="monthlyAnalysisSummaryData"
                            [monthlyAnalysisSummaryData]="groupSummary.monthlyAnalysisSummaryData"
                            [analysisItem]="analysisItem"
                            [facilityOrAccount]="facility"></app-rolling-energy-savings-graph>
                        <hr>
                        <div class="print-break-after"></div>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </div>
</div>


<div class="report" *ngIf="calculating != false">
    <app-calculating-spinner [message]="'Calculating Facility Savings...'"
        [error]="calculating == 'error'"></app-calculating-spinner>
</div>

<app-facility-print-report-button></app-facility-print-report-button>