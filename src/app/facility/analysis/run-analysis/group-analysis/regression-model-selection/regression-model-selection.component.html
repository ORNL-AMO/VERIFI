

<app-regression-model-menu></app-regression-model-menu>

<hr>

<div class="table-responsive" *ngIf="selectedGroup.models">

    <table class="table table-sm table-hover">
        <thead>
            <tr>
                <th>
                    Select<br> Model
                </th>
                <th class="can-click" (click)="setOrderDataField('modelYear')"
                    [ngClass]="{'active': orderDataField == 'modelYear'}">
                    Model<br> Year
                </th>
                <th>
                    Variable<br> p-Values
                </th>
                <th class="can-click" (click)="setOrderDataField('R2')" [ngClass]="{'active': orderDataField == 'R2'}">
                    R2
                </th>
                <th class="can-click" (click)="setOrderDataField('adjust_R2')"
                    [ngClass]="{'active': orderDataField == 'adjust_R2'}">
                    Adjusted<br> R2
                </th>
                <th class="can-click" (click)="setOrderDataField('modelPValue')"
                    [ngClass]="{'active': orderDataField == 'modelPValue'}">
                    Model<br> p-Value
                </th>
                <th>
                    Formula
                </th>
                <th>
                    Model Notes
                </th>
                <th *ngIf="showInvalid">
                    Valid
                </th>
            </tr>
        </thead>
        <tbody>
            <tr
                *ngFor="let model of selectedGroup.models | orderBy: orderDataField: orderByDirection | modelFilter:showInvalid; let modelIndex = index;">
                <td *ngIf="!model.errorModeling">
                    <input type="radio" class="rowToggle" [(ngModel)]="selectedGroup.selectedModelId"
                        [value]="model.modelId" name="{{modelIndex+'_selectedModelId'}}"
                        id="{{modelIndex+'_selectedModelId'}}" (change)="selectModel()">
                </td>
                <td *ngIf="!model.errorModeling">
                    {{model.modelYear}}
                </td>
                <td *ngIf="!model.errorModeling">
                    <span *ngFor="let pVal of model.t.p; let index = index">
                        <span *ngIf="index != 0">{{model.predictorVariables[index-1].name}}: {{pVal | customNumber}}
                            <br>
                        </span>
                    </span>
                </td>
                <td *ngIf="!model.errorModeling">
                    {{model.R2| customNumber}}
                </td>
                <td *ngIf="!model.errorModeling">
                    {{model.adjust_R2| customNumber}}
                </td>
                <td *ngIf="!model.errorModeling">
                    {{model.modelPValue| customNumber}}
                </td>
                <td *ngIf="!model.errorModeling">
                    <span *ngFor="let coefVal of model.coef; let index = index;">
                        <span *ngIf="index == 0">{{coefVal| customNumber}}</span>
                        <span *ngIf="index != 0">({{coefVal|
                            customNumber}}*{{model.predictorVariables[index-1].name}})</span> <span
                            *ngIf="index != model.coef.length-1"> +</span>
                    </span>
                </td>
                <td *ngIf="!model.errorModeling">
                    <span *ngFor="let notes of model.modelNotes">
                        {{notes}}<br>
                    </span>
                    <span *ngIf="model.modelNotes.length == 0">
                        &mdash;
                    </span>
                </td>
                <td *ngIf="showInvalid && !model.errorModeling">
                    <span *ngIf="model.isValid">Valid</span>
                    <span *ngIf="!model.isValid">Invalid</span>
                </td>
                <!--error modeling-->
                <td class="alert-danger" *ngIf="model.errorModeling" colspan="9">
                    There was an error when generating model for {{model.modelYear}}: <span class="pr-1" *ngFor="let variable of model.predictorVariables">{{variable.name}}</span>.
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- <div class="popup" [class.open]="showUpdateModelsModal">
    <div class="popup-header">Are you sure you want to update the models?
        <button class="item-right" (click)="closeUpdateModelsModal()">x</button>
    </div>
    <div class="popup-body">
        <p>WARNING: Updated models will replace existing models. This cannot be undone.</p>
    </div>
    <div class="saveCancel popup-footer text-right">
        <button class="btn btn-secondary" (click)="closeUpdateModelsModal()">Cancel</button>
        <button class="btn btn-success" (click)="confirmUpdateModals()">Update Models</button>
    </div>
</div> -->