<div *ngIf="calculating == false">
    <div class="report" [ngClass]="{'print': print}"
        *ngIf="accountSavingsReportSetup.includeAnnualResults && (accountSavingsReportSetup.includeAnnualResultsTable || accountSavingsReportSetup.includeAnnualResultsGraph || accountSavingsReportSetup.includeAccountMonthlyTable || accountSavingsReportSetup.includeAccountMonthlyResults)">
        <div class="text-center">
            <h3>
                {{ selectedReport.name }}
            </h3>
            <h6>
                Generated By VERIFI
            </h6>
        </div>
        <ng-container
            *ngIf="accountSavingsReportSetup.includeAnnualResultsTable || accountSavingsReportSetup.includeAnnualResultsGraph">
            <h4>
                Annual Company Analysis
            </h4>

            <ng-container *ngIf="accountSavingsReportSetup.includeAnnualResultsTable">
                <ng-template
                    [ngIf]="!print || !(accountSavingsReportSetup.analysisTableColumns | breakUpTableForPrint: 'annual')"
                    [ngIfElse]="printBlock">
                    <div class="scroll-x">
                        <app-annual-analysis-summary-table [annualAnalysisSummary]="annualAnalysisSummaries"
                            [analysisItem]="selectedAnalysisItem" [latestMonthSummary]="latestMonthSummary"
                            [accountOrFacility]="account" [printBlock]="'all'">
                        </app-annual-analysis-summary-table>
                    </div>
                </ng-template>

                <ng-template #printBlock>
                    <app-annual-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'consumption'"
                        [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="selectedAnalysisItem"
                        [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="account"
                        [printBlock]="'consumption'">
                    </app-annual-analysis-summary-table>
                    <app-annual-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'predictors'"
                        [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="selectedAnalysisItem"
                        [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="account"
                        [printBlock]="'predictors'">
                    </app-annual-analysis-summary-table>
                    <app-annual-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'savings'"
                        [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="selectedAnalysisItem"
                        [latestMonthSummary]="latestMonthSummary" [accountOrFacility]="account"
                        [printBlock]="'savings'">
                    </app-annual-analysis-summary-table>
                </ng-template>

                <div class="print-break-after"></div>
            </ng-container>

            <ng-container *ngIf="accountSavingsReportSetup.includeAnnualResultsGraph">
                <app-annual-analysis-summary-graph [annualAnalysisSummary]="annualAnalysisSummaries"
                    [annualAnalysisSummary]="annualAnalysisSummaries" [analysisItem]="selectedAnalysisItem">
                </app-annual-analysis-summary-graph>
                <div class="print-break-after"></div>
            </ng-container>
        </ng-container>

        <ng-container
            *ngIf="monthlyAnalysisSummaryData && monthlyAnalysisSummaryData.length > 0 && accountSavingsReportSetup.includeAccountMonthlyTable">
            <h4>
                Monthly Company Analysis
            </h4>
            <div class="d-flex w-100 justify-content-end mb-2">
                <app-table-items-dropdown></app-table-items-dropdown>
            </div>
            <ng-container>
                <ng-template
                    [ngIf]="!print || !(accountSavingsReportSetup.analysisTableColumns | breakUpTableForPrint: 'monthly')"
                    [ngIfElse]="reportPrintBlock">
                    <div class="scroll-x">
                        <app-monthly-analysis-summary-table [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData"
                            [analysisItem]="selectedAnalysisItem" [facilityOrAccount]="account"
                            [itemsPerPage]="itemsPerPage" [printBlock]="'all'">
                        </app-monthly-analysis-summary-table>
                    </div>
                </ng-template>

                <ng-template #reportPrintBlock>
                    <app-monthly-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'consumption'"
                        [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="selectedAnalysisItem"
                        [facilityOrAccount]="account" [itemsPerPage]="itemsPerPage" [printBlock]="'consumption'">
                    </app-monthly-analysis-summary-table>

                    <app-monthly-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'predictors'"
                        [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="selectedAnalysisItem"
                        [facilityOrAccount]="account" [itemsPerPage]="itemsPerPage" [printBlock]="'predictors'">
                    </app-monthly-analysis-summary-table>

                    <app-monthly-analysis-summary-table
                        *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'savings'"
                        [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [analysisItem]="selectedAnalysisItem"
                        [facilityOrAccount]="account" [itemsPerPage]="itemsPerPage" [printBlock]="'savings'">
                    </app-monthly-analysis-summary-table>
                </ng-template>
                <div class="print-break-after"></div>
            </ng-container>
        </ng-container>

        <ng-container
            *ngIf="monthlyAnalysisSummaryData && monthlyAnalysisSummaryData.length > 0 && accountSavingsReportSetup.includeAccountMonthlyResults">
            <i><u>
                    <h5 class="text-center">Monthly Analysis</h5>
                </u></i>
            <div class="print-break-avoid">
                <app-monthly-analysis-summary-graph [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData"
                    [analysisItem]="selectedAnalysisItem" [facilityOrAccount]="account">
                </app-monthly-analysis-summary-graph>
            </div>
            <div class="print-break-avoid">
                <app-monthly-analysis-summary-savings-graph [analysisItem]="selectedAnalysisItem"
                    [monthlyAnalysisSummaryData]="monthlyAnalysisSummaryData" [facilityOrAccount]="account">
                </app-monthly-analysis-summary-savings-graph>
            </div>
            <div class="print-break-after"></div>
        </ng-container>
    </div>

    <div
        *ngIf="accountSavingsReportSetup.includeFacilityResults && (accountSavingsReportSetup.includeFacilityResultsTable || accountSavingsReportSetup.includeFacilityResultsGraph || accountSavingsReportSetup.includeFacilityMonthlyResultsGraph)">
        <div class="report" [ngClass]="{'print': print}">
            <div class="text-center"
                *ngIf="!accountSavingsReportSetup.includeAnnualResults || (!accountSavingsReportSetup.includeAnnualResultsTable && !accountSavingsReportSetup.includeAnnualResultsGraph && !accountSavingsReportSetup.includeAccountMonthlyTable && !accountSavingsReportSetup.includeAccountMonthlyResults)">
                <h3>
                    {{ selectedReport.name }}
                </h3>
                <h6>
                    Generated By VERIFI
                </h6>
            </div>
            <ng-container>
                <div *ngFor="let summary of facilitySummaries" class="summary-margin">
                    <h4>
                        Annual {{ summary.facility.name }} Analysis
                    </h4>
                    <ng-container
                        *ngIf="summary.annualAnalysisSummaries && summary.annualAnalysisSummaries.length > 0 && accountSavingsReportSetup.includeFacilityResultsTable">
                        <ng-template
                            [ngIf]="!print || !(accountSavingsReportSetup.analysisTableColumns | breakUpTableForPrint: 'annual')"
                            [ngIfElse]="printBlock">
                            <div class="scroll-x">
                                <app-annual-analysis-summary-table
                                    [annualAnalysisSummary]="summary.annualAnalysisSummaries"
                                    [analysisItem]="summary.analysisItem"
                                    [latestMonthSummary]="summary.latestMonthSummary"
                                    [accountOrFacility]="summary.facility" [printBlock]="'all'">
                                </app-annual-analysis-summary-table>
                            </div>
                        </ng-template>

                        <ng-template #printBlock>
                            <app-annual-analysis-summary-table
                                *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'consumption'"
                                [annualAnalysisSummary]="summary.annualAnalysisSummaries"
                                [analysisItem]="summary.analysisItem" [latestMonthSummary]="summary.latestMonthSummary"
                                [accountOrFacility]="summary.facility" [printBlock]="'consumption'">
                            </app-annual-analysis-summary-table>
                            <app-annual-analysis-summary-table
                                *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'predictors'"
                                [annualAnalysisSummary]="summary.annualAnalysisSummaries"
                                [analysisItem]="summary.analysisItem" [latestMonthSummary]="summary.latestMonthSummary"
                                [accountOrFacility]="summary.facility" [printBlock]="'predictors'">
                            </app-annual-analysis-summary-table>
                            <app-annual-analysis-summary-table
                                *ngIf="accountSavingsReportSetup.analysisTableColumns | includeTable: 'savings'"
                                [annualAnalysisSummary]="summary.annualAnalysisSummaries"
                                [analysisItem]="summary.analysisItem" [latestMonthSummary]="summary.latestMonthSummary"
                                [accountOrFacility]="summary.facility" [printBlock]="'savings'">
                            </app-annual-analysis-summary-table>
                        </ng-template>

                        <div class="print-break-after"></div>
                    </ng-container>

                    <ng-container
                        *ngIf="summary.annualAnalysisSummaries && summary.annualAnalysisSummaries.length > 0 && accountSavingsReportSetup.includeFacilityResultsGraph">
                        <div class="print-break-avoid">
                            <app-annual-analysis-summary-graph [annualAnalysisSummary]="summary.annualAnalysisSummaries"
                                [analysisItem]="summary.analysisItem">
                            </app-annual-analysis-summary-graph>
                        </div>
                        <div class="print-break-after"></div>
                    </ng-container>

                    <div
                        *ngIf="summary.monthlySummaryData && summary.monthlySummaryData.length > 0 && accountSavingsReportSetup.includeFacilityMonthlyResultsGraph">
                        <i><u>
                                <h5 class="text-center">Monthly Analysis</h5>
                            </u></i>
                        <div class="print-break-avoid">
                            <app-monthly-analysis-summary-graph
                                [monthlyAnalysisSummaryData]="summary.monthlySummaryData"
                                [analysisItem]="summary.analysisItem" [facilityOrAccount]="summary.facility">
                            </app-monthly-analysis-summary-graph>
                        </div>
                        <div class="print-break-avoid">
                            <app-monthly-analysis-summary-savings-graph [analysisItem]="summary.analysisItem"
                                [monthlyAnalysisSummaryData]="summary.monthlySummaryData"
                                [facilityOrAccount]="summary.facility">
                            </app-monthly-analysis-summary-savings-graph>
                        </div>
                        <hr>
                        <div class="print-break-after"></div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>

    <div
        *ngIf="performanceReport.annualFacilityData.length > 0 && performanceReport.facilityTotals.length > 0 && (accountSavingsReportSetup.includePerformanceResults && (accountSavingsReportSetup.includePerformanceResultsTable || accountSavingsReportSetup.includePerformanceResultsGraph))">
        <div class="report" [ngClass]="{'print': print}">
            <div class="text-center"
                *ngIf="(!accountSavingsReportSetup.includeAnnualResults && !accountSavingsReportSetup.includeFacilityResults) || (!accountSavingsReportSetup.includeAnnualResultsTable && !accountSavingsReportSetup.includeAnnualResultsGraph && !accountSavingsReportSetup.includeAccountMonthlyTable && !accountSavingsReportSetup.includeAccountMonthlyResults && !accountSavingsReportSetup.includeFacilityResultsTable && !accountSavingsReportSetup.includeFacilityResultsGraph && !accountSavingsReportSetup.includeFacilityMonthlyResultsGraph)">
                <h3>
                    {{ selectedReport.name }}
                </h3>
                <h6>
                    Generated By VERIFI
                </h6>
            </div>
            <ng-container>
                <h4>
                    Facility Performance Analysis
                </h4>
                <ng-container *ngIf="performanceReport && accountSavingsReportSetup.includePerformanceResultsTable">

                    <ng-template
                        [ngIf]="!print || !(setupDetails.includeActual || setupDetails.includeAdjusted || setupDetails.includeSavings || setupDetails.includeContribution)"
                        [ngIfElse]="printBlock">
                        <div class="scroll-x">
                            <app-performance-report-facility-table [account]="account"
                                [performanceReport]="performanceReport" [selectedAnalysisItem]="selectedAnalysisItem"
                                [performanceReportSetup]="setupDetails" [printBlock]="'all'">
                            </app-performance-report-facility-table>
                        </div>
                    </ng-template>

                    <ng-template #printBlock>
                        <app-performance-report-facility-table *ngIf="setupDetails.includeActual" [account]="account"
                            [performanceReport]="performanceReport" [selectedAnalysisItem]="selectedAnalysisItem"
                            [performanceReportSetup]="setupDetails" [printBlock]="'actual'">
                        </app-performance-report-facility-table>

                        <app-performance-report-facility-table *ngIf="setupDetails.includeAdjusted" [account]="account"
                            [performanceReport]="performanceReport" [selectedAnalysisItem]="selectedAnalysisItem"
                            [performanceReportSetup]="setupDetails" [printBlock]="'adjusted'">
                        </app-performance-report-facility-table>

                        <app-performance-report-facility-table *ngIf="setupDetails.includeSavings" [account]="account"
                            [performanceReport]="performanceReport" [selectedAnalysisItem]="selectedAnalysisItem"
                            [performanceReportSetup]="setupDetails" [printBlock]="'savings'">
                        </app-performance-report-facility-table>

                        <app-performance-report-facility-table *ngIf="setupDetails.includeContribution"
                            [account]="account" [performanceReport]="performanceReport"
                            [selectedAnalysisItem]="selectedAnalysisItem" [performanceReportSetup]="setupDetails"
                            [printBlock]="'contribution'">
                        </app-performance-report-facility-table>
                    </ng-template>

                    <div class="print-break-after"></div>
                </ng-container>

                <ng-container *ngIf="performanceReport && accountSavingsReportSetup.includePerformanceResultsGraph">
                    <app-performance-chart [performanceReport]="performanceReport" [chartDataOption]="'savings'"
                        [chartDataType]="'facility'" [performanceReportSetup]="setupDetails"></app-performance-chart>
                </ng-container>
            </ng-container>
        </div>
    </div>
</div>

<div class="w-100 justify-content-center">
    <div class="pt-5">
        <app-calculating-spinner *ngIf="calculating != false" [message]="'Generating Savings Report...'"
            [error]="calculating == 'error'"></app-calculating-spinner>
    </div>
</div>

<app-print-report-button *ngIf="selectedReport"></app-print-report-button>