<div class="d-flex w-100">
    <div>
        <button class="btn btn-outline m-0" (click)="createNewItem()">+Add Facility Analysis</button>
    </div>
</div>
<hr>

<div class="table-responsive">
    <table class="table table-sm table-hover">
        <thead>
            <tr>
                <th></th>
                <th>Analysis Item</th>
                <th>
                    Report Year
                </th>
                <th>
                    Site or Source Energy?
                </th>
                <th>
                    Group Analysis
                </th>
                <th>Last Modified</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let analysisItem of facilityAnalysisItems">
                <td>
                    <input type="radio" class="rowToggle" [(ngModel)]="selectedFacilityItemId"
                        [value]="analysisItem.guid" name="{{analysisItem.id+'_selectedFacilityItemId'}}"
                        id="{{analysisItem.id+'_selectedFacilityItemId'}}" (change)="save()">
                </td>
                <td>
                    {{analysisItem.name}}
                </td>
                <td>{{analysisItem.reportYear}}</td>
                <td>
                    <span *ngIf="analysisItem.energyIsSource">Source</span>
                    <span *ngIf="!analysisItem.energyIsSource">Site</span>
                </td>
                <td>
                    <span *ngFor="let group of analysisItem.groups">
                        {{group.idbGroupId | groupName}}:
                        <span *ngIf="group.analysisType == 'absoluteEnergyConsumption'">Absolute Energy
                            Consumption</span>
                        <span *ngIf="group.analysisType == 'energyIntensity'">Energy Intensity</span>
                        <span *ngIf="group.analysisType == 'modifiedEnergyIntensity'">Modified Energy Intensity</span>
                        <span *ngIf="group.analysisType == 'regression'">Regression</span>
                        <br>
                    </span>
                </td>
                <td>{{analysisItem.date | date}}</td>
                <td class="actions">
                    <!-- <div class="d-flex">
                        <i class="fa fa-pencil" title="Edit" (click)="editItem(analysisItem)"></i>
                    </div> -->
                    <a class="click-link" (click)="editItem(analysisItem)">View Analysis</a>
                </td>
            </tr>
            <tr *ngIf="facilityAnalysisItems.length == 0">
                <td colspan="7" class="text-center">
                    No <span *ngIf="selectedAnalysisItem.energyIsSource">source energy</span>
                    <span *ngIf="!selectedAnalysisItem.energyIsSource">site energy</span> analysis items found matching
                    the selected report year!<br>
                    Click the "+Add Facility Analysis" button to conduct a facility level analysis that will be added to
                    this account analysis in progress.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" class="rowToggle" [(ngModel)]="selectedFacilityItemId" [value]="undefined"
                        name="{{facility.name+'undefined'}}" id="{{facility.name+'undefined'}}" (change)="save()">
                </td>
                <td colspan="6">
                    Skip Facility
                </td>
            </tr>
        </tbody>
    </table>
</div>
<hr>
<div class="d-flex w-100 justify-content-between">
    <div>
        <button class="btn btn-secondary" (click)="goBack()">Back</button>
    </div>
    <div>
        <button class="btn btn-secondary" (click)="continue()">Continue</button>
    </div>
</div>

<div class="popup" [class.open]="itemToEdit">
    <div class="popup-header" *ngIf="itemToEdit">Go To: {{itemToEdit.name}}
        <button class="item-right" (click)="cancelEditItem()">x</button>
    </div>
    <div class="popup-body">
        <p>WARNING: Are you sure you want to go to this analysis item? Your progress will be saved and you will leave
            this screen.</p>
    </div>
    <div class="saveCancel popup-footer text-right">
        <button class="btn btn-secondary" (click)="cancelEditItem()">Cancel</button>
        <button class="btn btn-outline" (click)="confirmEditItem()">Go To Facility Analysis</button>
    </div>
</div>



<div class="popup" [class.open]="showCreateItem">
    <div class="popup-header">Create New Facility Analysis
        <button class="item-right" (click)="cancelCreateNew()">x</button>
    </div>
    <div class="popup-body">
        <p>WARNING: Are you sure you want to create a new analysis item for this facility? Your progress will be saved
            and you will leave
            this screen.</p>
    </div>
    <div class="saveCancel popup-footer text-right">
        <button class="btn btn-secondary" (click)="cancelCreateNew()">Cancel</button>
        <button class="btn btn-outline" (click)="confirmCreateNew()">Create Facility Analysis</button>
    </div>
</div>